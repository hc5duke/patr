<html>
    <head>
        <title>Patr Options Page</title>
        <link rel=StyleSheet href="options.css" type='text/css'>
    <script type="text/javascript">

        function load_options(){
            var pre_bg = new Image();
            var pre_fg = new Image();
            pre_fg.id = 'pre_fg';
            pre_bg.src = chrome.extension.getURL("images/ecBG.png");
            pre_fg.src = chrome.extension.getURL("images/ecFG.png");

            pre_fg.className = ' fgShadow';
            pre_fg.className += ' fgCorners';

            document.getElementById('preview').appendChild( pre_bg );
            document.getElementById('preview').appendChild( pre_fg );

            pre_fg.className = pre_fg.className.replace(' fgShadow','');
            pre_fg.className = pre_fg.className.replace(' fgCorners','');

			for( var key in localStorage ){
				document.getElementById( key ).checked = localStorage[key] == 'true' ? true : false;
				if( key == 'ecRound' ){ apply( 'fgCorners', document.getElementById( key ).checked ); }
				if( key == 'ecShadow' ){ apply( 'fgShadow', document.getElementById( key ).checked ); }
			}
        }

        function doAllEC( clicked ){
            var inputs = document.querySelectorAll("input[name^='ec']");
            var alreadyChecked = document.querySelector("input[name='ecAll']").checked;
            if( clicked == 'input' ){ alreadyChecked = !alreadyChecked; }
            console.log( alreadyChecked );
            for( key in inputs ){
                if( parseInt(key+1) ){
                    inputs[key].checked = alreadyChecked ? false : true;
                    localStorage[ inputs[key].name ] = inputs[key].checked;
                }
            }
            if( alreadyChecked ){
                var img = document.getElementById('pre_fg');
                img.className = '';
            }else{
                var img = document.getElementById('pre_fg');
                img.className = ' fgShadow fgCorners';
            }
        }

        function doMe( el ){
            localStorage[ el.name ] = el.checked;
			if( el.checked == false ){ 
				localStorage['ecAll'] = false;
				document.getElementById('ecAll').checked = false;
			}
            if( el.name == 'ecRound' ){ 
				apply( 'fgCorners', el.checked );
            }
            if( el.name == 'ecShadow' ){
				apply( 'fgShadow', el.checked );
            }
        }
		
		function apply( cname, applyit){
			var img = document.getElementById('pre_fg');
			img.className = applyit ?
				img.className += ' '+cname : img.className = img.className.replace(' '+cname, '');
		}

        function showPreview(){
            document.getElementById('preview').style.opacity = 1;
            document.getElementById('preview').style.visibility = 'visible';
        }
        function hidePreview(){
            document.getElementById('preview').style.opacity = 0;
            document.getElementById('preview').style.visibility = 'hidden';
        }
    </script>

    </head>


<body onload="load_options()"
    <h1>Patr Options</h1>
    <span style='float: left;' onmouseout="hidePreview()" onmouseover="showPreview()" >
        <div style='font-size: 2em; border-bottom: solid 1px gray;'>Eye Candy</div>

    <input onclick="doAllEC('input');" type="checkbox" name="ecAll" id="ecAll" value="ecAll" />
    <span onclick="doAllEC( 'span' );" class='ecOpt' style='display: inline;'>All Effects</span>
    <br />
    <div class='ecOpt' onclick="this.firstElementChild.checked = !this.firstElementChild.checked;doMe( this.firstElementChild );">
        <input onclick="this.checked = !this.checked;" type="checkbox" name="ecRound" id="ecRound" value="ecRound" />
        Rounded Corners</div>

    <div class='ecOpt' onclick="this.firstElementChild.checked=!this.firstElementChild.checked;doMe(this.firstElementChild);">
        <input onclick="this.checked = !this.checked;" type="checkbox" name="ecShadow" id="ecShadow" value="ecShadow" />
        Drop Shadows</div>
    
    </span>
    <div id='preview' ></div>


</body>
</html>
